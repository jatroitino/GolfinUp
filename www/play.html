<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <meta name="format-detection" content="telephone=no" />
    <meta name="msapplication-tap-highlight" content="no" />
    <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width" />
    <!-- This is a wide open CSP declaration. To lock this down for production, see below. -->
    <meta http-equiv="Content-Security-Policy" content="default-src * 'unsafe-inline'; style-src 'self' 'unsafe-inline'; media-src *" />
    <!-- Good default declaration:
    * gap: is required only on iOS (when using UIWebView) and is needed for JS->native communication
    * https://ssl.gstatic.com is required only on Android and is needed for TalkBack to function properly
    * Disables use of eval() and inline scripts in order to mitigate risk of XSS vulnerabilities. To change this:
        * Enable inline JS: add 'unsafe-inline' to default-src
        * Enable eval(): add 'unsafe-eval' to default-src
    * Create your own at http://cspisawesome.com
    -->
    <!-- <meta http-equiv="Content-Security-Policy" content="default-src 'self' data: gap: 'unsafe-inline' https://ssl.gstatic.com; style-src 'self' 'unsafe-inline'; media-src *" /> -->

    <link rel="stylesheet" type="text/css" href="css/bootstrap.min.css" />
    <link rel="stylesheet" type="text/css" href="css/index.css" />
    <title>GolfinUp</title>
</head>

<body id="play">
    <div class="app conatiner">
		<div class="row">
			<div class="col-sm-2"></div>
			<div class="col-sm-8">
				<div id="logo">
					<img src="img/icono-jugar.svg" />
				<h2>Let's start!</h2>
				<p>On what golf course are you?</p>
					<input type="text" name="course" id="course" class="form-control typeahead"  placeholder="Introduce el campo" />
					<a id="nearme" href=""><svg data-name="Layer 1" id="Layer_1" viewBox="0 0 48 48" xmlns="http://www.w3.org/2000/svg"><defs><style>.cls-1{fill:none;stroke:#0076ff;stroke-linecap:round;stroke-linejoin:round;stroke-width:2px;}</style></defs><title/><polyline class="cls-1" points="47 1 25.82 47 21.44 26.56 1 22.18 47 1"/></svg>
					  Search near me
					</a>
					<div id="coursesops"></div>
					<a href="" id="tonext" class="btn btn-secondary">Siguiente</a>
				</div>
			</div>
			<div class="col-sm-2"></div>
		</div>
    </div>
<footer class="fixed-bottom">
	<div class="container-fluid">
		<div class="col-3">
			<a href="home.html">
				<img src="img/home_inactive.svg"><br>Dashboard
			</a>
		</div>
		<div class="col-3 active">
			<a href="play.html">
				<img src="img/input.svg"><br>Input
			</a>
		</div>
		<div class="col-3">
			<a href="stats.html">
				<img src="img/stats_inactive.svg"><br>Stats
			</a>
		</div>
		<div class="col-3">
			<a href="ajustes.html">
				<img src="img/ajustes_inactive.svg"><br>Config.
			</a>
		</div>
	</div>
</footer>
    <script type="text/javascript" src="cordova.js"></script>
    <script type="text/javascript" src="https://unpkg.com/popper.js"></script>
    <script type="text/javascript" src="js/jquery.min.js"></script>
    <script type="text/javascript" src="js/bootstrap.min.js"></script>
    <script type="text/javascript" src="js/bootstrap3-typeahead.min.js"></script>
    <script type="text/javascript" src="js/play.js"></script>
    <script type="text/javascript">
        app.initialize();
		var sourceplaces = [];
		var sourceplaces2 = JSON.parse(window.localStorage.getItem('sourceplaces2'));
		if (sourceplaces2 == null){
			sourceplaces2 = new Array();
		}
		
		var crd;
		$(document).ready(function(){
			//navigator.geolocation.getCurrentPosition(geosuccess,geoError,{ enableHighAccuracy: true });
			
			$.ajax({
				type: 'post',
				cache: false,
				url: 'http://proyectosweb.info/golf/privado/get_las_tour',
				data: {
					'user_id':window.localStorage.getItem("user_id")
				},
				dataType: 'json',
				success: function(response){
					if (response == null) response = 0;
					window.localStorage.setItem("tour",parseInt(response)+1);
					//window.location.href = 'input.html';
				}
			});
		});
		
		$('input[name="course"]').change(function(){
			window.localStorage.setItem("course", $(this).val());
		});

		$('#nearme').click(function(event){
			event.preventDefault();
			if ($(this).hasClass('disabled')){
				$(this).removeClass('disabled');
				$(".typeahead").data('typeahead').source = sourceplaces;
			} else {
				$(this).addClass('disabled');
				$(".typeahead").data('typeahead').source = sourceplaces2;
			}
		});
		
		$('#tonext').click(function(e){
			e.preventDefault();
			
			if (!sourceplaces2.includes($('#course').val())){
				sourceplaces2.push($('#course').val());
				window.localStorage.setItem('sourceplaces2',JSON.stringify(sourceplaces2));
			}
			
			window.location.href='condiciones.html';
		});
		
		function geosuccess(pos) {
		  crd = pos.coords;

		  //console.log('Your current position is:');
		 // alert('Latitude : ' + crd.latitude + ', Longitude: ' + crd.longitude);
		  //console.log();
		  //console.log('More or less ' + crd.accuracy + ' meters.');
			$.ajax({
					type: 'get',
					cache: false,
					url: 'https://maps.googleapis.com/maps/api/place/nearbysearch/json',
					data: {
						'location': crd.latitude+','+crd.longitude,
						'radius': '50000',
						'keyword': 'golf course',
						'key':'AIzaSyDoY5pf3EJ7XzcI-jvpYg3s6s2uG3BiCVY'
					},
					dataType: 'json',
					success: function(response){
						var html = '';
						for (i=0;i<response.results.length;i++){
							 //console.log(response.results[i].name);
							sourceplaces[i]=response.results[i].name;
							html += response.results[i].name+'<br>';
						}
						//$('#coursesops').html(html);
						
						$('.typeahead').typeahead({
							source: sourceplaces
						});
					}
				});
		  
		};
		
		function geoError(error) {
			alert('code: '    + error.code    + '\n' +
				  'message: ' + error.message + '\n');
		}
    </script>
</body>

</html>